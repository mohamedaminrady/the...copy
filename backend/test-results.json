
> @the-copy/backend@1.0.0 test K:\theeeecopy\backend
> vitest "--" "--reporter=json"


[1m[46m RUN [49m[22m [36mv4.0.9 [39m[90mK:/theeeecopy/backend[39m

 [31m‚ùØ[39m src/controllers/shots.controller.test.ts [2m([22m[2m32 tests[22m[2m | [22m[31m21 failed[39m[2m)[22m[32m 42[2mms[22m[39m
[31m       [31m√ó[31m should return shots for authorized user[39m[32m 9[2mms[22m[39m
       [32m‚úì[39m should return 401 for unauthorized user[32m 3[2mms[22m[39m
       [32m‚úì[39m should return 400 when scene ID is missing[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle database errors gracefully[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should order shots by orderIndex in ascending order[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return shot for authorized user[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should return 401 for unauthorized user[32m 1[2mms[22m[39m
       [32m‚úì[39m should return 400 when shot ID is missing[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when shot not found[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should verify shot ownership through project[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should create shot with valid data[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should return 401 for unauthorized user[32m 0[2mms[22m[39m
       [32m‚úì[39m should validate shot data using Zod schema[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle database insertion failure[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should work with minimal required data[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update shot with valid data[39m[32m 3[2mms[22m[39m
       [32m‚úì[39m should return 401 for unauthorized user[32m 1[2mms[22m[39m
       [32m‚úì[39m should return 400 when shot ID is missing[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when shot not found[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should validate update data using Zod schema[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update only provided fields[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should delete shot successfully[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m should return 401 for unauthorized user[32m 0[2mms[22m[39m
       [32m‚úì[39m should return 400 when shot ID is missing[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when shot not found[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should verify shot ownership through project[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should reorder shots successfully[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 401 for unauthorized user[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when scene ID is missing[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when scene not found[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should validate reorder data using Zod schema[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle empty shots array[39m[32m 1[2mms[22m[39m
 [31m‚ùØ[39m src/services/cache.service.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 1145[2mms[22m[39m
       [32m‚úì[39m should get value from L1 cache when available[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should get value from L2 cache when L1 misses[39m[32m 8[2mms[22m[39m
       [32m‚úì[39m should return null on cache miss[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set value in both L1 and L2 cache[39m[32m 2[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle expired L1 cache entries [33m 1102[2mms[22m[39m
       [32m‚úì[39m should fallback to L1 when Redis is unavailable[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should fallback to L1 when Redis connection fails[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle Redis get errors gracefully[32m 1[2mms[22m[39m
       [32m‚úì[39m should track Redis connection health[32m 1[2mms[22m[39m
       [32m‚úì[39m should validate TTL and use default for invalid values[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject values exceeding MAX_VALUE_SIZE[32m 4[2mms[22m[39m
       [32m‚úì[39m should validate cache key format[32m 2[2mms[22m[39m
       [32m‚úì[39m should generate consistent keys for same data[32m 1[2mms[22m[39m
       [32m‚úì[39m should generate different keys for different data[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should delete from both L1 and L2[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should clear all cache[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m should clear cache by pattern[32m 1[2mms[22m[39m
       [32m‚úì[39m should evict oldest entry when cache is full[32m 1[2mms[22m[39m
       [32m‚úì[39m should track cache hit rates[32m 1[2mms[22m[39m
       [32m‚úì[39m should reset metrics[32m 1[2mms[22m[39m
       [32m‚úì[39m should track Redis connection health[32m 1[2mms[22m[39m
       [32m‚úì[39m should preserve type information with generics[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle different value types[32m 2[2mms[22m[39m
       [32m‚úì[39m should handle JSON parse errors gracefully[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle Redis connection errors[32m 0[2mms[22m[39m
 [31m‚ùØ[39m src/db/index.test.ts [2m([22m[2m10 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[32m 28[2mms[22m[39m
[31m       [31m√ó[31m should throw error when DATABASE_URL is not set[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should initialize Pool with DATABASE_URL[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should configure neon websocket constructor[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should call drizzle with pool and schema[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should export pool instance[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should export db instance[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should use correct connection string format[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle connection strings with special characters[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should provide helpful error message for missing DATABASE_URL[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should throw on empty DATABASE_URL[32m 1[2mms[22m[39m
 [31m‚ùØ[39m src/controllers/characters.controller.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[32m 40[2mms[22m[39m
[31m       [31m√ó[31m should return characters for authorized user[39m[32m 13[2mms[22m[39m
       [32m‚úì[39m should return 401 for unauthorized user[32m 1[2mms[22m[39m
       [32m‚úì[39m should return 400 when projectId is missing[32m 1[2mms[22m[39m
       [32m‚úì[39m should return 404 when project not found[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle database errors gracefully[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return character for authorized user[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should return 404 when character not found[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 403 when user does not own character project[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should create character with valid data[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should validate character data using Zod schema[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when project does not exist[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle database insertion failure[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update character with valid data[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should return 404 when character does not exist[32m 1[2mms[22m[39m
       [32m‚úì[39m should validate update data using Zod schema[32m 1[2mms[22m[39m
       [32m‚úì[39m should delete character successfully[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when character does not exist[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 403 when user does not own character project[39m[32m 1[2mms[22m[39m
 [31m‚ùØ[39m src/controllers/auth.controller.test.ts [2m([22m[2m10 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should successfully create a new user[39m[32m 9[2mms[22m[39m
       [32m‚úì[39m should handle validation errors[32m 4[2mms[22m[39m
       [32m‚úì[39m should handle duplicate email error[32m 2[2mms[22m[39m
       [32m‚úì[39m should work with optional firstName and lastName[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should successfully login user[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should handle validation errors[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle invalid credentials[32m 1[2mms[22m[39m
       [32m‚úì[39m should successfully logout user[32m 1[2mms[22m[39m
       [32m‚úì[39m should return current user[32m 1[2mms[22m[39m
       [32m‚úì[39m should return 401 if user not authenticated[32m 1[2mms[22m[39m
 [31m‚ùØ[39m src/services/analysis.service.test.ts [2m([22m[2m10 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should successfully run complete pipeline[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should call Gemini service for station 1 analysis[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return station1 output with correct structure[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should track execution time[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle Gemini service errors[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should include all 7 stations in output[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should extract characters from analysis text[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should limit characters to 10[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should extract relationships[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should include relationship properties[39m[32m 0[2mms[22m[39m
 [32m‚úì[39m src/middleware/index.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 2045[2mms[22m[39m
       [33m[2m‚úì[22m[39m should set security headers [33m 1675[2mms[22m[39m
 [32m‚úì[39m src/db/connection.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 113[2mms[22m[39m
 [32m‚úì[39m src/__tests__/smoke/api-endpoints.smoke.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 84[2mms[22m[39m
 [32m‚úì[39m src/config/env.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 65[2mms[22m[39m
 [32m‚úì[39m src/utils/redis-health.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 43[2mms[22m[39m
 [32m‚úì[39m src/controllers/scenes.controller.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32m‚úì[39m src/test/security.comprehensive.test.ts [2m([22m[2m28 tests[22m[2m)[22m[33m 515[2mms[22m[39m
 [32m‚úì[39m src/middleware/auth.middleware.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 21[2mms[22m[39m
 [32m‚úì[39m src/controllers/projects.controller.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 17[2mms[22m[39m
 [32m‚úì[39m src/services/auth.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32m‚úì[39m src/types/index.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 18[2mms[22m[39m
 [32m‚úì[39m src/utils/logger.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [31m‚ùØ[39m src/services/gemini.service.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m11 failed[39m[2m)[22m[33m 55174[2mms[22m[39m
[31m       [31m√ó[31m should successfully analyze text for characters[39m[33m 5017[2mms[22m[39m
[31m       [31m√ó[31m should analyze themes correctly[39m[33m 5008[2mms[22m[39m
[31m       [31m√ó[31m should analyze structure correctly[39m[33m 5015[2mms[22m[39m
[31m       [31m√ó[31m should default to characters analysis for unknown type[39m[33m 5016[2mms[22m[39m
[31m       [31m√ó[31m should handle API errors gracefully[39m[33m 5018[2mms[22m[39m
[31m       [31m√ó[31m should include text in the prompt[39m[33m 5016[2mms[22m[39m
[31m       [31m√ó[31m should successfully review screenplay[39m[33m 5018[2mms[22m[39m
[31m       [31m√ó[31m should include review criteria in prompt[39m[33m 5015[2mms[22m[39m
[31m       [31m√ó[31m should include screenplay text in prompt[39m[33m 5016[2mms[22m[39m
[31m       [31m√ó[31m should handle API errors[39m[33m 5024[2mms[22m[39m
[31m       [31m√ó[31m should build correct prompt for each analysis type[39m[33m 5008[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Suites 11 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m src/controllers/analysis.controller.test.ts[2m [ src/controllers/analysis.controller.test.ts ][22m
[41m[1m FAIL [22m[49m src/queues/queue.config.test.ts[2m [ src/queues/queue.config.test.ts ][22m
[41m[1m FAIL [22m[49m src/queues/jobs/ai-analysis.job.test.ts[2m [ src/queues/jobs/ai-analysis.job.test.ts ][22m
[41m[1m FAIL [22m[49m src/queues/jobs/document-processing.job.test.ts[2m [ src/queues/jobs/document-processing.job.test.ts ][22m
[41m[1m FAIL [22m[49m src/queues/__tests__/integration.test.ts[2m [ src/queues/__tests__/integration.test.ts ][22m
[41m[1m FAIL [22m[49m src/__tests__/smoke/queue-system.smoke.test.ts[2m [ src/__tests__/smoke/queue-system.smoke.test.ts ][22m
[31m[1mError[22m: Cannot find module 'K:\theeeecopy\node_modules\.pnpm\bullmq@5.63.1\node_modules\tslib\tslib.js'[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/cache-metrics.service.test.ts[2m [ src/services/cache-metrics.service.test.ts ][22m
[31m[1mError[22m: No test suite found in file K:/theeeecopy/backend/src/services/cache-metrics.service.test.ts[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/realtime.service.test.ts[2m [ src/services/realtime.service.test.ts ][22m
[31m[1mReferenceError[22m: jest is not defined[39m
[36m [2m‚ùØ[22m src/services/realtime.service.test.ts:[2m13:1[22m[39m
    [90m 11| [39m
    [90m 12| [39m[90m// Mock the underlying services[39m
    [90m 13| [39mjest[33m.[39m[34mmock[39m([32m'./websocket.service'[39m)[33m;[39m
    [90m   | [39m[31m^[39m
    [90m 14| [39mjest[33m.[39m[34mmock[39m([32m'./sse.service'[39m)[33m;[39m
    [90m 15| [39mjest[33m.[39m[34mmock[39m([32m'@/utils/logger'[39m[33m,[39m () [33m=>[39m ({

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/sse.service.test.ts[2m [ src/services/sse.service.test.ts ][22m
[31m[1mReferenceError[22m: jest is not defined[39m
[36m [2m‚ùØ[22m src/services/sse.service.test.ts:[2m20:1[22m[39m
    [90m 18| [39m
    [90m 19| [39m[90m// Mock logger[39m
    [90m 20| [39mjest[33m.[39m[34mmock[39m([32m'@/utils/logger'[39m[33m,[39m () [33m=>[39m ({
    [90m   | [39m[31m^[39m
    [90m 21| [39m  logger[33m:[39m {
    [90m 22| [39m    info[33m:[39m jest[33m.[39m[34mfn[39m()[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/websocket.service.test.ts[2m [ src/services/websocket.service.test.ts ][22m
[31m[1mReferenceError[22m: jest is not defined[39m
[36m [2m‚ùØ[22m src/services/websocket.service.test.ts:[2m17:9[22m[39m
    [90m 15| [39m  authenticated[33m:[39m [35mfalse[39m[33m,[39m
    [90m 16| [39m  rooms[33m:[39m [35mnew[39m [33mSet[39m([[32m'test-socket-id'[39m])[33m,[39m
    [90m 17| [39m  join[33m:[39m jest[33m.[39m[34mfn[39m()[33m,[39m
    [90m   | [39m        [31m^[39m
    [90m 18| [39m  leave[33m:[39m jest[33m.[39m[34mfn[39m()[33m,[39m
    [90m 19| [39m  emit[33m:[39m jest[33m.[39m[34mfn[39m()[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/integration/controllers.integration.test.ts[2m [ src/__tests__/integration/controllers.integration.test.ts ][22m
[31m[1mError[22m: Cannot find module 'K:\theeeecopy\node_modules\.pnpm\bullmq@5.63.1\node_modules\tslib\tslib.js'[39m
[90m [2m‚ùØ[22m Function.Module._resolveFilename ../node_modules/.pnpm/module-alias@2.2.3/node_modules/module-alias/index.js:[2m49:29[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/77]‚éØ[22m[39m


[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 66 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m src/controllers/auth.controller.test.ts[2m > [22mAuthController[2m > [22msignup[2m > [22mshould successfully create a new user
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 'token', 'jwt-token', ‚Ä¶(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/auth.controller.test.ts:[2m85:35[22m[39m
    [90m 83| [39m      )[33m;[39m
    [90m 84| [39m
    [90m 85| [39m      expect(mockResponse.cookie).toHaveBeenCalledWith('token', mockTo‚Ä¶
    [90m   | [39m                                  [31m^[39m
    [90m 86| [39m        httpOnly[33m:[39m [35mtrue[39m[33m,[39m
    [90m 87| [39m        secure[33m:[39m [35mfalse[39m[33m,[39m [90m// In test environment[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/auth.controller.test.ts[2m > [22mAuthController[2m > [22mlogin[2m > [22mshould successfully login user
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 'token', 'jwt-token', ‚Ä¶(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/auth.controller.test.ts:[2m197:35[22m[39m
    [90m195| [39m      )[33m;[39m
    [90m196| [39m
    [90m197| [39m      expect(mockResponse.cookie).toHaveBeenCalledWith('token', mockTo‚Ä¶
    [90m   | [39m                                  [31m^[39m
    [90m198| [39m        httpOnly[33m:[39m [35mtrue[39m[33m,[39m
    [90m199| [39m        secure[33m:[39m [35mfalse[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/characters.controller.test.ts[2m > [22mCharactersController[2m > [22mgetCharacters[2m > [22mshould return characters for authorized user
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ { success: true, ‚Ä¶(1) } ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    {[22m
[32m-     "data": [[90m
[32m-       {[90m
[32m-         "id": "char-1",[90m
[32m-         "name": "Test Character",[90m
[32m-         "projectId": "project-1",[90m
[32m-       },[90m
[32m-     ],[90m
[32m-     "success": true,[90m
[31m+     "error": "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ¨ŸÑÿ® ÿßŸÑÿ¥ÿÆÿµŸäÿßÿ™",[90m
[31m+     "success": false,[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/characters.controller.test.ts:[2m86:33[22m[39m
    [90m 84| [39m      )[33m;[39m
    [90m 85| [39m
    [90m 86| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m   | [39m                                [31m^[39m
    [90m 87| [39m        success[33m:[39m [35mtrue[39m[33m,[39m
    [90m 88| [39m        data[33m:[39m mockCharacters[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/characters.controller.test.ts[2m > [22mCharactersController[2m > [22mgetCharacter[2m > [22mshould return character for authorized user
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ { success: true, data: { ‚Ä¶(3) } } ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    {[22m
[32m-     "data": {[90m
[32m-       "id": "char-1",[90m
[32m-       "name": "Test Character",[90m
[32m-       "projectId": "project-1",[90m
[32m-     },[90m
[32m-     "success": true,[90m
[31m+     "error": "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ¨ŸÑÿ® ÿßŸÑÿ¥ÿÆÿµŸäÿ©",[90m
[31m+     "success": false,[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/characters.controller.test.ts:[2m181:33[22m[39m
    [90m179| [39m      )[33m;[39m
    [90m180| [39m
    [90m181| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m   | [39m                                [31m^[39m
    [90m182| [39m        success[33m:[39m [35mtrue[39m[33m,[39m
    [90m183| [39m        data[33m:[39m mockCharacter[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/characters.controller.test.ts[2m > [22mCharactersController[2m > [22mgetCharacter[2m > [22mshould return 403 when user does not own character project
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 403 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   403,[90m
[31m+   500,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/characters.controller.test.ts:[2m227:35[22m[39m
    [90m225| [39m      )[33m;[39m
    [90m226| [39m
    [90m227| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m403[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m228| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m229| [39m        success[33m:[39m [35mfalse[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/characters.controller.test.ts[2m > [22mCharactersController[2m > [22mcreateCharacter[2m > [22mshould create character with valid data
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 201 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   201,[90m
[31m+   500,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/characters.controller.test.ts:[2m262:35[22m[39m
    [90m260| [39m      )[33m;[39m
    [90m261| [39m
    [90m262| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m201[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m263| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m264| [39m        success[33m:[39m [35mtrue[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/characters.controller.test.ts[2m > [22mCharactersController[2m > [22mcreateCharacter[2m > [22mshould return 404 when project does not exist
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 404 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   404,[90m
[31m+   500,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/characters.controller.test.ts:[2m304:35[22m[39m
    [90m302| [39m      )[33m;[39m
    [90m303| [39m
    [90m304| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m404[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m305| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m306| [39m        success[33m:[39m [35mfalse[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[13/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/characters.controller.test.ts[2m > [22mCharactersController[2m > [22mcreateCharacter[2m > [22mshould handle database insertion failure
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ { success: false, ‚Ä¶(1) } ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    {[22m
[32m-     "error": "ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¥ÿÆÿµŸäÿ©",[90m
[31m+     "error": "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¥ÿÆÿµŸäÿ©",[90m
[2m      "success": false,[22m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/characters.controller.test.ts:[2m331:33[22m[39m
    [90m329| [39m
    [90m330| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m500[39m)[33m;[39m
    [90m331| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m   | [39m                                [31m^[39m
    [90m332| [39m        success[33m:[39m [35mfalse[39m[33m,[39m
    [90m333| [39m        error[33m:[39m [32m'ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¥ÿÆÿµŸäÿ©'[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[14/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/characters.controller.test.ts[2m > [22mCharactersController[2m > [22mupdateCharacter[2m > [22mshould update character with valid data
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ { success: true, ‚Ä¶(2) } ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    {[22m
[32m-     "data": {[90m
[32m-       "appearances": 10,[90m
[32m-       "id": "char-1",[90m
[32m-       "name": "Updated Character Name",[90m
[32m-     },[90m
[32m-     "message": "ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ¥ÿÆÿµŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠",[90m
[32m-     "success": true,[90m
[31m+     "error": "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ¥ÿÆÿµŸäÿ©",[90m
[31m+     "success": false,[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/characters.controller.test.ts:[2m373:33[22m[39m
    [90m371| [39m      )[33m;[39m
    [90m372| [39m
    [90m373| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m   | [39m                                [31m^[39m
    [90m374| [39m        success[33m:[39m [35mtrue[39m[33m,[39m
    [90m375| [39m        message[33m:[39m [32m'ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ¥ÿÆÿµŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠'[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[15/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/characters.controller.test.ts[2m > [22mCharactersController[2m > [22mdeleteCharacter[2m > [22mshould return 404 when character does not exist
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 404 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   404,[90m
[31m+   500,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/characters.controller.test.ts:[2m474:35[22m[39m
    [90m472| [39m      )[33m;[39m
    [90m473| [39m
    [90m474| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m404[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m475| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m476| [39m        success[33m:[39m [35mfalse[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[16/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/characters.controller.test.ts[2m > [22mCharactersController[2m > [22mdeleteCharacter[2m > [22mshould return 403 when user does not own character project
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 403 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   403,[90m
[31m+   404,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/characters.controller.test.ts:[2m500:35[22m[39m
    [90m498| [39m      )[33m;[39m
    [90m499| [39m
    [90m500| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m403[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m501| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m502| [39m        success[33m:[39m [35mfalse[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[17/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mgetShots[2m > [22mshould return shots for authorized user
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ { success: true, data: [ ‚Ä¶(2) ] } ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    {[22m
[32m-     "data": [[90m
[32m-       {[90m
[32m-         "id": "shot-1",[90m
[32m-         "sceneId": "scene-1",[90m
[32m-         "title": "Shot 1",[90m
[32m-       },[90m
[32m-       {[90m
[32m-         "id": "shot-2",[90m
[32m-         "sceneId": "scene-1",[90m
[32m-         "title": "Shot 2",[90m
[32m-       },[90m
[32m-     ],[90m
[32m-     "success": true,[90m
[31m+     "error": "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ¨ŸÑÿ® ÿßŸÑŸÑŸÇÿ∑ÿßÿ™",[90m
[31m+     "success": false,[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m86:33[22m[39m
    [90m 84| [39m      )[33m;[39m
    [90m 85| [39m
    [90m 86| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m   | [39m                                [31m^[39m
    [90m 87| [39m        success[33m:[39m [35mtrue[39m[33m,[39m
    [90m 88| [39m        data[33m:[39m mockShots[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[18/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mgetShots[2m > [22mshould order shots by orderIndex in ascending order
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ Any<Object> ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m162:30[22m[39m
    [90m160| [39m      )[33m;[39m
    [90m161| [39m
    [90m162| [39m      [34mexpect[39m(mockDb[33m.[39morderBy)[33m.[39m[34mtoHaveBeenCalledWith[39m(expect[33m.[39m[34many[39m([33mObject[39m))[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m163| [39m    })[33m;[39m
    [90m164| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[19/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mgetShot[2m > [22mshould return shot for authorized user
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ { success: true, data: { ‚Ä¶(3) } } ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    {[22m
[32m-     "data": {[90m
[32m-       "id": "shot-1",[90m
[32m-       "sceneId": "scene-1",[90m
[32m-       "title": "Test Shot",[90m
[32m-     },[90m
[32m-     "success": true,[90m
[31m+     "error": "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ¨ŸÑÿ® ÿßŸÑŸÑŸÇÿ∑ÿ©",[90m
[31m+     "success": false,[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m183:33[22m[39m
    [90m181| [39m      )[33m;[39m
    [90m182| [39m
    [90m183| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m   | [39m                                [31m^[39m
    [90m184| [39m        success[33m:[39m [35mtrue[39m[33m,[39m
    [90m185| [39m        data[33m:[39m mockShot[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[20/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mgetShot[2m > [22mshould return 404 when shot not found
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 404 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   404,[90m
[31m+   500,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m235:35[22m[39m
    [90m233| [39m      )[33m;[39m
    [90m234| [39m
    [90m235| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m404[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m236| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m237| [39m        success[33m:[39m [35mfalse[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[21/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mgetShot[2m > [22mshould verify shot ownership through project
[31m[1mAssertionError[22m: expected "vi.fn()" to be called at least once[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m258:26[22m[39m
    [90m256| [39m      )[33m;[39m
    [90m257| [39m
    [90m258| [39m      [34mexpect[39m(mockDb[33m.[39mand)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m259| [39m    })[33m;[39m
    [90m260| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mcreateShot[2m > [22mshould create shot with valid data
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 201 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   201,[90m
[31m+   400,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m286:35[22m[39m
    [90m284| [39m      )[33m;[39m
    [90m285| [39m
    [90m286| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m201[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m287| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m288| [39m        success[33m:[39m [35mtrue[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[23/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mcreateShot[2m > [22mshould handle database insertion failure
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 500 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   500,[90m
[31m+   400,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m351:35[22m[39m
    [90m349| [39m      )[33m;[39m
    [90m350| [39m
    [90m351| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m500[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m352| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m353| [39m        success[33m:[39m [35mfalse[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[24/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mcreateShot[2m > [22mshould work with minimal required data
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 201 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   201,[90m
[31m+   400,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m379:35[22m[39m
    [90m377| [39m      )[33m;[39m
    [90m378| [39m
    [90m379| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m201[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m380| [39m    })[33m;[39m
    [90m381| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[25/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mupdateShot[2m > [22mshould update shot with valid data
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ { success: true, ‚Ä¶(2) } ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    {[22m
[32m-     "data": {[90m
[32m-       "description": "Updated description",[90m
[32m-       "id": "shot-1",[90m
[32m-       "sceneId": "scene-1",[90m
[32m-       "title": "Updated Shot Title",[90m
[32m-     },[90m
[32m-     "message": "ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÑŸÇÿ∑ÿ© ÿ®ŸÜÿ¨ÿßÿ≠",[90m
[32m-     "success": true,[90m
[31m+     "error": "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÑŸÇÿ∑ÿ©",[90m
[31m+     "success": false,[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m415:33[22m[39m
    [90m413| [39m      )[33m;[39m
    [90m414| [39m
    [90m415| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m   | [39m                                [31m^[39m
    [90m416| [39m        success[33m:[39m [35mtrue[39m[33m,[39m
    [90m417| [39m        message[33m:[39m [32m'ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÑŸÇÿ∑ÿ© ÿ®ŸÜÿ¨ÿßÿ≠'[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[26/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mupdateShot[2m > [22mshould return 404 when shot not found
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 404 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   404,[90m
[31m+   500,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m471:35[22m[39m
    [90m469| [39m      )[33m;[39m
    [90m470| [39m
    [90m471| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m404[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m472| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m473| [39m        success[33m:[39m [35mfalse[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[27/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mupdateShot[2m > [22mshould validate update data using Zod schema
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 400 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   400,[90m
[31m+   500,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m497:35[22m[39m
    [90m495| [39m      )[33m;[39m
    [90m496| [39m
    [90m497| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m400[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m498| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m499| [39m        success[33m:[39m [35mfalse[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[28/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mupdateShot[2m > [22mshould update only provided fields
[31m[1mAssertionError[22m: expected "vi.fn()" to be called at least once[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m531:29[22m[39m
    [90m529| [39m      )[33m;[39m
    [90m530| [39m
    [90m531| [39m      [34mexpect[39m(mockDb[33m.[39mupdate)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m532| [39m    })[33m;[39m
    [90m533| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[29/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mdeleteShot[2m > [22mshould delete shot successfully
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ { success: true, ‚Ä¶(1) } ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    {[22m
[32m-     "message": "ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÑŸÇÿ∑ÿ© ÿ®ŸÜÿ¨ÿßÿ≠",[90m
[32m-     "success": true,[90m
[31m+     "error": "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑŸÑŸÇÿ∑ÿ©",[90m
[31m+     "success": false,[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m556:33[22m[39m
    [90m554| [39m      )[33m;[39m
    [90m555| [39m
    [90m556| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m   | [39m                                [31m^[39m
    [90m557| [39m        success[33m:[39m [35mtrue[39m[33m,[39m
    [90m558| [39m        message[33m:[39m [32m'ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÑŸÇÿ∑ÿ© ÿ®ŸÜÿ¨ÿßÿ≠'[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[30/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mdeleteShot[2m > [22mshould return 404 when shot not found
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 404 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   404,[90m
[31m+   500,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m608:35[22m[39m
    [90m606| [39m      )[33m;[39m
    [90m607| [39m
    [90m608| [39m      [34mexpect[39m(mockResponse[33m.[39mstatus)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m404[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m609| [39m      [34mexpect[39m(mockResponse[33m.[39mjson)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m610| [39m        success[33m:[39m [35mfalse[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[31/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mdeleteShot[2m > [22mshould verify shot ownership through project
[31m[1mAssertionError[22m: expected "vi.fn()" to be called at least once[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m635:26[22m[39m
    [90m633| [39m      )[33m;[39m
    [90m634| [39m
    [90m635| [39m      [34mexpect[39m(mockDb[33m.[39mand)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m636| [39m    })[33m;[39m
    [90m637| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[32/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mreorderShots[2m > [22mshould reorder shots successfully
[31m[1mTypeError[22m: __vi_import_0__.shotsController.reorderShots is not a function[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m663:29[22m[39m
    [90m661| [39m      mockRequest[33m.[39mbody [33m=[39m { shots[33m:[39m reorderData }[33m;[39m
    [90m662| [39m
    [90m663| [39m      [35mawait[39m shotsController[33m.[39m[34mreorderShots[39m(
    [90m   | [39m                            [31m^[39m
    [90m664| [39m        mockRequest [35mas[39m any[33m,[39m
    [90m665| [39m        mockResponse [35mas[39m [33mResponse[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[33/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mreorderShots[2m > [22mshould return 401 for unauthorized user
[31m[1mTypeError[22m: __vi_import_0__.shotsController.reorderShots is not a function[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m680:29[22m[39m
    [90m678| [39m      mockRequest[33m.[39mbody [33m=[39m { shots[33m:[39m [] }[33m;[39m
    [90m679| [39m
    [90m680| [39m      [35mawait[39m shotsController[33m.[39m[34mreorderShots[39m(
    [90m   | [39m                            [31m^[39m
    [90m681| [39m        mockRequest [35mas[39m any[33m,[39m
    [90m682| [39m        mockResponse [35mas[39m [33mResponse[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[34/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mreorderShots[2m > [22mshould return 400 when scene ID is missing
[31m[1mTypeError[22m: __vi_import_0__.shotsController.reorderShots is not a function[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m696:29[22m[39m
    [90m694| [39m      mockRequest[33m.[39mbody [33m=[39m { shots[33m:[39m [] }[33m;[39m
    [90m695| [39m
    [90m696| [39m      [35mawait[39m shotsController[33m.[39m[34mreorderShots[39m(
    [90m   | [39m                            [31m^[39m
    [90m697| [39m        mockRequest [35mas[39m any[33m,[39m
    [90m698| [39m        mockResponse [35mas[39m [33mResponse[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[35/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mreorderShots[2m > [22mshould return 404 when scene not found
[31m[1mTypeError[22m: __vi_import_0__.shotsController.reorderShots is not a function[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m718:29[22m[39m
    [90m716| [39m      mockRequest[33m.[39mbody [33m=[39m { shots[33m:[39m [] }[33m;[39m
    [90m717| [39m
    [90m718| [39m      [35mawait[39m shotsController[33m.[39m[34mreorderShots[39m(
    [90m   | [39m                            [31m^[39m
    [90m719| [39m        mockRequest [35mas[39m any[33m,[39m
    [90m720| [39m        mockResponse [35mas[39m [33mResponse[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[36/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mreorderShots[2m > [22mshould validate reorder data using Zod schema
[31m[1mTypeError[22m: __vi_import_0__.shotsController.reorderShots is not a function[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m746:29[22m[39m
    [90m744| [39m      }[33m;[39m
    [90m745| [39m
    [90m746| [39m      [35mawait[39m shotsController[33m.[39m[34mreorderShots[39m(
    [90m   | [39m                            [31m^[39m
    [90m747| [39m        mockRequest [35mas[39m any[33m,[39m
    [90m748| [39m        mockResponse [35mas[39m [33mResponse[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[37/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/controllers/shots.controller.test.ts[2m > [22mShotsController[2m > [22mreorderShots[2m > [22mshould handle empty shots array
[31m[1mTypeError[22m: __vi_import_0__.shotsController.reorderShots is not a function[39m
[36m [2m‚ùØ[22m src/controllers/shots.controller.test.ts:[2m771:29[22m[39m
    [90m769| [39m      mockRequest[33m.[39mbody [33m=[39m { shots[33m:[39m [] }[33m;[39m
    [90m770| [39m
    [90m771| [39m      [35mawait[39m shotsController[33m.[39m[34mreorderShots[39m(
    [90m   | [39m                            [31m^[39m
    [90m772| [39m        mockRequest [35mas[39m any[33m,[39m
    [90m773| [39m        mockResponse [35mas[39m [33mResponse[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[38/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/db/index.test.ts[2m > [22mDatabase Module[2m > [22mInitialization[2m > [22mshould throw error when DATABASE_URL is not set
[31m[1mAssertionError[22m: expected [Function] to throw error including 'DATABASE_URL must be set' but got 'Cannot find module \'./index\'\nRequi‚Ä¶'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- DATABASE_URL must be set[39m
[31m+ Cannot find module './index'[39m
[31m+ Require stack:[39m
[31m+ - K:\theeeecopy\backend\src\db\index.test.ts[39m

[36m [2m‚ùØ[22m src/db/index.test.ts:[2m55:10[22m[39m
    [90m 53| [39m        [35mdelete[39m require[33m.[39mcache[require[33m.[39m[34mresolve[39m([32m'./index'[39m)][33m;[39m
    [90m 54| [39m        [34mrequire[39m([32m'./index'[39m)[33m;[39m
    [90m 55| [39m      })[33m.[39m[34mtoThrow[39m([32m'DATABASE_URL must be set'[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m 56| [39m    })[33m;[39m
    [90m 57| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/db/index.test.ts[2m > [22mDatabase Module[2m > [22mInitialization[2m > [22mshould initialize Pool with DATABASE_URL
[31m[1mError[22m: Cannot find module './index'
Require stack:
- K:\theeeecopy\backend\src\db\index.test.ts[39m
[36m [2m‚ùØ[22m src/db/index.test.ts:[2m62:36[22m[39m
    [90m 60| [39m
    [90m 61| [39m      [90m// Clear cache and re-import[39m
    [90m 62| [39m      [35mdelete[39m require[33m.[39mcache[require[33m.[39m[34mresolve[39m([32m'./index'[39m)][33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 63| [39m      [35mconst[39m db [33m=[39m [34mrequire[39m([32m'./index'[39m)[33m;[39m
    [90m 64| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[40/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/db/index.test.ts[2m > [22mDatabase Module[2m > [22mInitialization[2m > [22mshould configure neon websocket constructor
[31m[1mError[22m: Cannot find module './index'
Require stack:
- K:\theeeecopy\backend\src\db\index.test.ts[39m
[36m [2m‚ùØ[22m src/db/index.test.ts:[2m74:36[22m[39m
    [90m 72| [39m
    [90m 73| [39m      [90m// Clear cache and re-import[39m
    [90m 74| [39m      [35mdelete[39m require[33m.[39mcache[require[33m.[39m[34mresolve[39m([32m'./index'[39m)][33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 75| [39m      [35mconst[39m { neonConfig } [33m=[39m [34mrequire[39m([32m'@neondatabase/serverless'[39m)[33m;[39m
    [90m 76| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[41/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/db/index.test.ts[2m > [22mDatabase Module[2m > [22mInitialization[2m > [22mshould call drizzle with pool and schema
[31m[1mError[22m: Cannot find module './index'
Require stack:
- K:\theeeecopy\backend\src\db\index.test.ts[39m
[36m [2m‚ùØ[22m src/db/index.test.ts:[2m88:36[22m[39m
    [90m 86| [39m
    [90m 87| [39m      [90m// Clear cache and re-import[39m
    [90m 88| [39m      [35mdelete[39m require[33m.[39mcache[require[33m.[39m[34mresolve[39m([32m'./index'[39m)][33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 89| [39m      [34mrequire[39m([32m'./index'[39m)[33m;[39m
    [90m 90| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[42/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/db/index.test.ts[2m > [22mDatabase Module[2m > [22mExports[2m > [22mshould export pool instance
[31m[1mError[22m: Cannot find module './index'
Require stack:
- K:\theeeecopy\backend\src\db\index.test.ts[39m
[36m [2m‚ùØ[22m src/db/index.test.ts:[2m106:36[22m[39m
    [90m104| [39m
    [90m105| [39m    [34mit[39m([32m'should export pool instance'[39m[33m,[39m () [33m=>[39m {
    [90m106| [39m      [35mdelete[39m require[33m.[39mcache[require[33m.[39m[34mresolve[39m([32m'./index'[39m)][33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m107| [39m      [35mconst[39m { pool } [33m=[39m [34mrequire[39m([32m'./index'[39m)[33m;[39m
    [90m108| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[43/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/db/index.test.ts[2m > [22mDatabase Module[2m > [22mExports[2m > [22mshould export db instance
[31m[1mError[22m: Cannot find module './index'
Require stack:
- K:\theeeecopy\backend\src\db\index.test.ts[39m
[36m [2m‚ùØ[22m src/db/index.test.ts:[2m113:36[22m[39m
    [90m111| [39m
    [90m112| [39m    [34mit[39m([32m'should export db instance'[39m[33m,[39m () [33m=>[39m {
    [90m113| [39m      [35mdelete[39m require[33m.[39mcache[require[33m.[39m[34mresolve[39m([32m'./index'[39m)][33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m114| [39m      [35mconst[39m { db } [33m=[39m [34mrequire[39m([32m'./index'[39m)[33m;[39m
    [90m115| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[44/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/db/index.test.ts[2m > [22mDatabase Module[2m > [22mConfiguration[2m > [22mshould use correct connection string format
[31m[1mError[22m: Cannot find module './index'
Require stack:
- K:\theeeecopy\backend\src\db\index.test.ts[39m
[36m [2m‚ùØ[22m src/db/index.test.ts:[2m125:36[22m[39m
    [90m123| [39m      process[33m.[39menv[33m.[39m[33mDATABASE_URL[39m [33m=[39m testUrl[33m;[39m
    [90m124| [39m
    [90m125| [39m      [35mdelete[39m require[33m.[39mcache[require[33m.[39m[34mresolve[39m([32m'./index'[39m)][33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m126| [39m      [34mrequire[39m([32m'./index'[39m)[33m;[39m
    [90m127| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[45/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/db/index.test.ts[2m > [22mDatabase Module[2m > [22mConfiguration[2m > [22mshould handle connection strings with special characters
[31m[1mError[22m: Cannot find module './index'
Require stack:
- K:\theeeecopy\backend\src\db\index.test.ts[39m
[36m [2m‚ùØ[22m src/db/index.test.ts:[2m137:36[22m[39m
    [90m135| [39m      process[33m.[39menv[33m.[39m[33mDATABASE_URL[39m [33m=[39m complexUrl[33m;[39m
    [90m136| [39m
    [90m137| [39m      [35mdelete[39m require[33m.[39mcache[require[33m.[39m[34mresolve[39m([32m'./index'[39m)][33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m138| [39m      [34mrequire[39m([32m'./index'[39m)[33m;[39m
    [90m139| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[46/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/db/index.test.ts[2m > [22mDatabase Module[2m > [22mError Handling[2m > [22mshould provide helpful error message for missing DATABASE_URL
[31m[1mAssertionError[22m: expected 'Cannot find module \'./index\'\nRequi‚Ä¶' to contain 'DATABASE_URL must be set'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- DATABASE_URL must be set[39m
[31m+ Cannot find module './index'[39m
[31m+ Require stack:[39m
[31m+ - K:\theeeecopy\backend\src\db\index.test.ts[39m

[36m [2m‚ùØ[22m src/db/index.test.ts:[2m155:31[22m[39m
    [90m153| [39m        expect[33m.[39m[34mfail[39m([32m'Should have thrown error'[39m)[33m;[39m
    [90m154| [39m      } [35mcatch[39m (error[33m:[39m any) {
    [90m155| [39m        [34mexpect[39m(error[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'DATABASE_URL must be set'[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m156| [39m        expect(error.message).toContain('Did you forget to provision a‚Ä¶
    [90m157| [39m      }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[47/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/analysis.service.test.ts[2m > [22mAnalysisService[2m > [22mrunFullPipeline[2m > [22mshould successfully run complete pipeline
[31m[1mError[22m: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±[39m
[36m [2m‚ùØ[22m AnalysisService.runStation6 src/services/analysis.service.ts:[2m214:13[22m[39m
    [90m212| [39m    } [35mcatch[39m (error) {
    [90m213| [39m      logger[33m.[39m[34merror[39m([32m'Station 6 failed:'[39m[33m,[39m error)[33m;[39m
    [90m214| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m215| [39m    }
    [90m216| [39m  }
[90m [2m‚ùØ[22m AnalysisService.runFullPipeline src/services/analysis.service.ts:[2m26:14[22m[39m
[90m [2m‚ùØ[22m src/services/analysis.service.test.ts:[2m45:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[48/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/analysis.service.test.ts[2m > [22mAnalysisService[2m > [22mrunFullPipeline[2m > [22mshould call Gemini service for station 1 analysis
[31m[1mError[22m: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±[39m
[36m [2m‚ùØ[22m AnalysisService.runStation6 src/services/analysis.service.ts:[2m214:13[22m[39m
    [90m212| [39m    } [35mcatch[39m (error) {
    [90m213| [39m      logger[33m.[39m[34merror[39m([32m'Station 6 failed:'[39m[33m,[39m error)[33m;[39m
    [90m214| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m215| [39m    }
    [90m216| [39m  }
[90m [2m‚ùØ[22m AnalysisService.runFullPipeline src/services/analysis.service.ts:[2m26:14[22m[39m
[90m [2m‚ùØ[22m src/services/analysis.service.test.ts:[2m58:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[49/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/analysis.service.test.ts[2m > [22mAnalysisService[2m > [22mrunFullPipeline[2m > [22mshould return station1 output with correct structure
[31m[1mError[22m: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±[39m
[36m [2m‚ùØ[22m AnalysisService.runStation6 src/services/analysis.service.ts:[2m214:13[22m[39m
    [90m212| [39m    } [35mcatch[39m (error) {
    [90m213| [39m      logger[33m.[39m[34merror[39m([32m'Station 6 failed:'[39m[33m,[39m error)[33m;[39m
    [90m214| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m215| [39m    }
    [90m216| [39m  }
[90m [2m‚ùØ[22m AnalysisService.runFullPipeline src/services/analysis.service.ts:[2m26:14[22m[39m
[90m [2m‚ùØ[22m src/services/analysis.service.test.ts:[2m71:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[50/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/analysis.service.test.ts[2m > [22mAnalysisService[2m > [22mrunFullPipeline[2m > [22mshould track execution time
[31m[1mError[22m: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±[39m
[36m [2m‚ùØ[22m AnalysisService.runStation6 src/services/analysis.service.ts:[2m214:13[22m[39m
    [90m212| [39m    } [35mcatch[39m (error) {
    [90m213| [39m      logger[33m.[39m[34merror[39m([32m'Station 6 failed:'[39m[33m,[39m error)[33m;[39m
    [90m214| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m215| [39m    }
    [90m216| [39m  }
[90m [2m‚ùØ[22m AnalysisService.runFullPipeline src/services/analysis.service.ts:[2m26:14[22m[39m
[90m [2m‚ùØ[22m src/services/analysis.service.test.ts:[2m88:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[51/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/analysis.service.test.ts[2m > [22mAnalysisService[2m > [22mrunFullPipeline[2m > [22mshould include all 7 stations in output
[31m[1mError[22m: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±[39m
[36m [2m‚ùØ[22m AnalysisService.runStation6 src/services/analysis.service.ts:[2m214:13[22m[39m
    [90m212| [39m    } [35mcatch[39m (error) {
    [90m213| [39m      logger[33m.[39m[34merror[39m([32m'Station 6 failed:'[39m[33m,[39m error)[33m;[39m
    [90m214| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m215| [39m    }
    [90m216| [39m  }
[90m [2m‚ùØ[22m AnalysisService.runFullPipeline src/services/analysis.service.ts:[2m26:14[22m[39m
[90m [2m‚ùØ[22m src/services/analysis.service.test.ts:[2m110:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[52/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/analysis.service.test.ts[2m > [22mAnalysisService[2m > [22mextractCharacters[2m > [22mshould extract characters from analysis text
[31m[1mError[22m: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±[39m
[36m [2m‚ùØ[22m AnalysisService.runStation6 src/services/analysis.service.ts:[2m214:13[22m[39m
    [90m212| [39m    } [35mcatch[39m (error) {
    [90m213| [39m      logger[33m.[39m[34merror[39m([32m'Station 6 failed:'[39m[33m,[39m error)[33m;[39m
    [90m214| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m215| [39m    }
    [90m216| [39m  }
[90m [2m‚ùØ[22m AnalysisService.runFullPipeline src/services/analysis.service.ts:[2m26:14[22m[39m
[90m [2m‚ùØ[22m src/services/analysis.service.test.ts:[2m133:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[53/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/analysis.service.test.ts[2m > [22mAnalysisService[2m > [22mextractCharacters[2m > [22mshould limit characters to 10
[31m[1mError[22m: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±[39m
[36m [2m‚ùØ[22m AnalysisService.runStation6 src/services/analysis.service.ts:[2m214:13[22m[39m
    [90m212| [39m    } [35mcatch[39m (error) {
    [90m213| [39m      logger[33m.[39m[34merror[39m([32m'Station 6 failed:'[39m[33m,[39m error)[33m;[39m
    [90m214| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m215| [39m    }
    [90m216| [39m  }
[90m [2m‚ùØ[22m AnalysisService.runFullPipeline src/services/analysis.service.ts:[2m26:14[22m[39m
[90m [2m‚ùØ[22m src/services/analysis.service.test.ts:[2m148:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[54/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/analysis.service.test.ts[2m > [22mAnalysisService[2m > [22mextractRelationships[2m > [22mshould extract relationships
[31m[1mError[22m: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±[39m
[36m [2m‚ùØ[22m AnalysisService.runStation6 src/services/analysis.service.ts:[2m214:13[22m[39m
    [90m212| [39m    } [35mcatch[39m (error) {
    [90m213| [39m      logger[33m.[39m[34merror[39m([32m'Station 6 failed:'[39m[33m,[39m error)[33m;[39m
    [90m214| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m215| [39m    }
    [90m216| [39m  }
[90m [2m‚ùØ[22m AnalysisService.runFullPipeline src/services/analysis.service.ts:[2m26:14[22m[39m
[90m [2m‚ùØ[22m src/services/analysis.service.test.ts:[2m164:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[55/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/analysis.service.test.ts[2m > [22mAnalysisService[2m > [22mextractRelationships[2m > [22mshould include relationship properties
[31m[1mError[22m: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±[39m
[36m [2m‚ùØ[22m AnalysisService.runStation6 src/services/analysis.service.ts:[2m214:13[22m[39m
    [90m212| [39m    } [35mcatch[39m (error) {
    [90m213| [39m      logger[33m.[39m[34merror[39m([32m'Station 6 failed:'[39m[33m,[39m error)[33m;[39m
    [90m214| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≠ŸÖÿ±'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m215| [39m    }
    [90m216| [39m  }
[90m [2m‚ùØ[22m AnalysisService.runFullPipeline src/services/analysis.service.ts:[2m26:14[22m[39m
[90m [2m‚ùØ[22m src/services/analysis.service.test.ts:[2m179:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[56/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/cache.service.test.ts[2m > [22mCacheService[2m > [22mL1/L2 Caching[2m > [22mshould get value from L2 cache when L1 misses
[31m[1mAssertionError[22m: expected null to deeply equal { data: 'test-value' }[39m

[32m- Expected:[39m 
{
  "data": "test-value",
}

[31m+ Received:[39m 
null

[36m [2m‚ùØ[22m src/services/cache.service.test.ts:[2m132:22[22m[39m
    [90m130| [39m      [90m// Get should fetch from L2 and populate L1[39m
    [90m131| [39m      [35mconst[39m result [33m=[39m [35mawait[39m cacheService[33m.[39m[35mget[39m(key)[33m;[39m
    [90m132| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m(value)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m133| [39m
    [90m134| [39m      [90m// Verify Redis was called[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[57/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/cache.service.test.ts[2m > [22mCacheService[2m > [22mL1/L2 Caching[2m > [22mshould set value in both L1 and L2 cache
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 'test-key', 3600, ‚Ä¶(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2m‚ùØ[22m src/services/cache.service.test.ts:[2m175:31[22m[39m
    [90m173| [39m
    [90m174| [39m      [90m// Verify Redis was called[39m
    [90m175| [39m      [34mexpect[39m(mockRedis[33m.[39msetEx)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                              [31m^[39m
    [90m176| [39m        key[33m,[39m
    [90m177| [39m        ttl[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[58/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/cache.service.test.ts[2m > [22mCacheService[2m > [22mFallback Behavior[2m > [22mshould fallback to L1 when Redis connection fails
[31m[1mAssertionError[22m: expected 0 to be greater than 0[39m
[36m [2m‚ùØ[22m src/services/cache.service.test.ts:[2m251:36[22m[39m
    [90m249| [39m      [90m// Verify metrics show error[39m
    [90m250| [39m      [35mconst[39m stats [33m=[39m cacheService[33m.[39m[34mgetStats[39m()[33m;[39m
    [90m251| [39m      [34mexpect[39m(stats[33m.[39mmetrics[33m.[39merrors)[33m.[39m[34mtoBeGreaterThan[39m([34m0[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m252| [39m    })[33m;[39m
    [90m253| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[59/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/cache.service.test.ts[2m > [22mCacheService[2m > [22mCache Operations[2m > [22mshould delete from both L1 and L2
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 'test-key' ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2m‚ùØ[22m src/services/cache.service.test.ts:[2m374:29[22m[39m
    [90m372| [39m
    [90m373| [39m      [90m// Verify Redis del was called[39m
    [90m374| [39m      [34mexpect[39m(mockRedis[33m.[39mdel)[33m.[39m[34mtoHaveBeenCalledWith[39m(key)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m375| [39m
    [90m376| [39m      [90m// Verify metrics[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[60/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/cache.service.test.ts[2m > [22mCacheService[2m > [22mCache Operations[2m > [22mshould clear all cache
[31m[1mAssertionError[22m: expected "vi.fn()" to be called at least once[39m
[36m [2m‚ùØ[22m src/services/cache.service.test.ts:[2m394:33[22m[39m
    [90m392| [39m
    [90m393| [39m      [90m// Verify Redis flushdb was called[39m
    [90m394| [39m      [34mexpect[39m(mockRedis[33m.[39mflushDb)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m395| [39m    })[33m;[39m
    [90m396| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[61/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/gemini.service.test.ts[2m > [22mGeminiService[2m > [22manalyzeText[2m > [22mshould successfully analyze text for characters
[31m[1mError[22m: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m src/services/gemini.service.test.ts:[2m29:5[22m[39m
    [90m 27| [39m
    [90m 28| [39m  [34mdescribe[39m([32m'analyzeText'[39m[33m,[39m () [33m=>[39m {
    [90m 29| [39m    [34mit[39m([32m'should successfully analyze text for characters'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m 30| [39m      [35mconst[39m mockResponse [33m=[39m [32m'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ¥ÿÆÿµŸäÿßÿ™: ÿßŸÑÿ®ÿ∑ŸÑÿå ÿßŸÑÿ¥ÿ±Ÿäÿ±'[39m[33m;[39m
    [90m 31| [39m      

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[62/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/gemini.service.test.ts[2m > [22mGeminiService[2m > [22manalyzeText[2m > [22mshould analyze themes correctly
[31m[1mError[22m: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m src/services/gemini.service.test.ts:[2m46:5[22m[39m
    [90m 44| [39m    })[33m;[39m
    [90m 45| [39m
    [90m 46| [39m    [34mit[39m([32m'should analyze themes correctly'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m 47| [39m      [35mconst[39m mockResponse [33m=[39m [32m'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸàÿßÿ∂Ÿäÿπ: ÿßŸÑÿ≠ÿ®ÿå ÿßŸÑÿµÿ±ÿßÿπ'[39m[33m;[39m
    [90m 48| [39m      

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[63/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/gemini.service.test.ts[2m > [22mGeminiService[2m > [22manalyzeText[2m > [22mshould analyze structure correctly
[31m[1mError[22m: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m src/services/gemini.service.test.ts:[2m63:5[22m[39m
    [90m 61| [39m    })[33m;[39m
    [90m 62| [39m
    [90m 63| [39m    [34mit[39m([32m'should analyze structure correctly'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m 64| [39m      [35mconst[39m mockResponse [33m=[39m [32m'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ®ŸÜŸäÿ©: ÿ®ÿØÿßŸäÿ© ŸÇŸàŸäÿ©'[39m[33m;[39m
    [90m 65| [39m      

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[64/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/gemini.service.test.ts[2m > [22mGeminiService[2m > [22manalyzeText[2m > [22mshould default to characters analysis for unknown type
[31m[1mError[22m: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m src/services/gemini.service.test.ts:[2m80:5[22m[39m
    [90m 78| [39m    })[33m;[39m
    [90m 79| [39m
    [90m 80| [39m    it('should default to characters analysis for unknown type', async‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m 81| [39m      [35mconst[39m mockResponse [33m=[39m [32m'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ¥ÿÆÿµŸäÿßÿ™'[39m[33m;[39m
    [90m 82| [39m      

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[65/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/gemini.service.test.ts[2m > [22mGeminiService[2m > [22manalyzeText[2m > [22mshould handle API errors gracefully
[31m[1mError[22m: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m src/services/gemini.service.test.ts:[2m96:5[22m[39m
    [90m 94| [39m    })[33m;[39m
    [90m 95| [39m
    [90m 96| [39m    [34mit[39m([32m'should handle API errors gracefully'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m 97| [39m      mockGenerateContent[33m.[39m[34mmockRejectedValue[39m([35mnew[39m [33mError[39m([32m'API Error'[39m))[33m;[39m
    [90m 98| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[66/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/gemini.service.test.ts[2m > [22mGeminiService[2m > [22manalyzeText[2m > [22mshould include text in the prompt
[31m[1mError[22m: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m src/services/gemini.service.test.ts:[2m104:5[22m[39m
    [90m102| [39m    })[33m;[39m
    [90m103| [39m
    [90m104| [39m    [34mit[39m([32m'should include text in the prompt'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m105| [39m      [35mconst[39m testText [33m=[39m [32m'ŸÜÿµ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÉÿßŸÖŸÑ'[39m[33m;[39m
    [90m106| [39m      

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[67/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/gemini.service.test.ts[2m > [22mGeminiService[2m > [22mreviewScreenplay[2m > [22mshould successfully review screenplay
[31m[1mError[22m: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m src/services/gemini.service.test.ts:[2m120:5[22m[39m
    [90m118| [39m
    [90m119| [39m  [34mdescribe[39m([32m'reviewScreenplay'[39m[33m,[39m () [33m=>[39m {
    [90m120| [39m    [34mit[39m([32m'should successfully review screenplay'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m121| [39m      [35mconst[39m mockReview [33m=[39m [32m'ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿπŸÑŸâ ÿßŸÑÿ≥ŸäŸÜÿßÿ±ŸäŸà: ÿßŸÑÿ≠ÿ®ŸÉÿ© ŸÇŸàŸäÿ©'[39m[33m;[39m
    [90m122| [39m      

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[68/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/gemini.service.test.ts[2m > [22mGeminiService[2m > [22mreviewScreenplay[2m > [22mshould include review criteria in prompt
[31m[1mError[22m: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m src/services/gemini.service.test.ts:[2m135:5[22m[39m
    [90m133| [39m    })[33m;[39m
    [90m134| [39m
    [90m135| [39m    [34mit[39m([32m'should include review criteria in prompt'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m136| [39m      mockGenerateContent[33m.[39m[34mmockResolvedValue[39m({
    [90m137| [39m        response[33m:[39m { text[33m:[39m () [33m=>[39m [32m'ŸÜÿ™Ÿäÿ¨ÿ©'[39m }[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[69/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/gemini.service.test.ts[2m > [22mGeminiService[2m > [22mreviewScreenplay[2m > [22mshould include screenplay text in prompt
[31m[1mError[22m: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m src/services/gemini.service.test.ts:[2m149:5[22m[39m
    [90m147| [39m    })[33m;[39m
    [90m148| [39m
    [90m149| [39m    [34mit[39m([32m'should include screenplay text in prompt'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m150| [39m      [35mconst[39m screenplay [33m=[39m [32m'ŸÜÿµ ÿßŸÑÿ≥ŸäŸÜÿßÿ±ŸäŸà ÿßŸÑŸÉÿßŸÖŸÑ ŸÑŸÑŸÖÿ±ÿßÿ¨ÿπÿ©'[39m[33m;[39m
    [90m151| [39m      

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[70/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/gemini.service.test.ts[2m > [22mGeminiService[2m > [22mreviewScreenplay[2m > [22mshould handle API errors
[31m[1mError[22m: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m src/services/gemini.service.test.ts:[2m163:5[22m[39m
    [90m161| [39m    })[33m;[39m
    [90m162| [39m
    [90m163| [39m    [34mit[39m([32m'should handle API errors'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m164| [39m      mockGenerateContent[33m.[39m[34mmockRejectedValue[39m([35mnew[39m [33mError[39m([32m'API Error'[39m))[33m;[39m
    [90m165| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[71/77]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/services/gemini.service.test.ts[2m > [22mGeminiService[2m > [22mbuildPrompt[2m > [22mshould build correct prompt for each analysis type
[31m[1mError[22m: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m src/services/gemini.service.test.ts:[2m173:5[22m[39m
    [90m171| [39m
    [90m172| [39m  [34mdescribe[39m([32m'buildPrompt'[39m[33m,[39m () [33m=>[39m {
    [90m173| [39m    it('should build correct prompt for each analysis type', async () ‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m174| [39m      [35mconst[39m testText [33m=[39m [32m'ŸÜÿµ ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±'[39m[33m;[39m
    [90m175| [39m      

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[72/77]‚éØ[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Unhandled Errors [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m
[31m[1m
Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Unhandled Rejection [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ[39m
[31m[1mTypeError[22m: __vite_ssr_import_2__.logger.warn is not a function[39m
[36m [2m‚ùØ[22m src/services/cache.service.ts:[2m155:16[22m[39m
    [90m153| [39m      [90m// Attempt to connect[39m
    [90m154| [39m      [35mthis[39m[33m.[39mredis[33m.[39m[34mconnect[39m()[33m.[39m[35mcatch[39m((error) [33m=>[39m {
    [90m155| [39m        logger.warn('Redis initial connection failed, using memory cac‚Ä¶
    [90m   | [39m               [31m^[39m
    [90m156| [39m        [35mthis[39m[33m.[39m[34mupdateRedisHealth[39m([32m'error'[39m)[33m;[39m
    [90m157| [39m        [35mthis[39m[33m.[39mredis [33m=[39m [35mnull[39m[33m;[39m
[90m [2m‚ùØ[22m processTicksAndRejections node:internal/process/task_queues:[2m105:5[22m[39m

[31mThis error originated in "[1msrc/controllers/shots.controller.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m


[2m Test Files [22m [1m[31m18 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (30)[39m
[2m      Tests [22m [1m[31m66 failed[39m[22m[2m | [22m[1m[32m213 passed[39m[22m[90m (279)[39m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 23:35:44
[2m   Duration [22m 56.87s[2m (transform 1.69s, setup 1.12s, collect 6.36s, tests 59.44s, environment 5ms, prepare 1.03s)[22m

[41m[30m‚ÄâELIFECYCLE‚Äâ[39m[49m [31mTest failed. See above for more details.[39m
